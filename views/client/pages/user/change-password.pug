extends ../../layouts/default.pug 
include ../../mixins/box-head.pug

block main  
  .container.my-5
    .row.justify-content-center
      .col-lg-6.col-md-8
        +box-head("Đổi mật khẩu")
        
        .card.shadow-sm
          .card-header.bg-white
            h5.mb-0
              i.fas.fa-key.me-2.text-primary
              | Thay đổi mật khẩu tài khoản
          
          .card-body
            form#change-password-form
              .mb-3
                label.form-label(for="currentPassword")
                  i.fas.fa-lock.me-2
                  | Mật khẩu hiện tại
                input#currentPassword.form-control(type="password" name="currentPassword" placeholder="Nhập mật khẩu hiện tại" required)
              
              .mb-3
                label.form-label(for="newPassword")
                  i.fas.fa-key.me-2
                  | Mật khẩu mới
                input#newPassword.form-control(type="password" name="newPassword" placeholder="Nhập mật khẩu mới" required)
                small.text-muted Mật khẩu phải có ít nhất 6 ký tự
              
              .mb-3
                label.form-label(for="confirmPassword")
                  i.fas.fa-check-circle.me-2
                  | Xác nhận mật khẩu mới
                input#confirmPassword.form-control(type="password" name="confirmPassword" placeholder="Nhập lại mật khẩu mới" required)
              
              .d-flex.justify-content-between.align-items-center
                button.btn.btn-primary(type="submit")
                  i.fas.fa-save.me-2
                  | Đổi mật khẩu
                
                a.btn.btn-outline-secondary(href="/user/info")
                  i.fas.fa-arrow-left.me-2
                  | Quay lại

block script
  script.
    document.getElementById('change-password-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = new FormData(this);
      const data = Object.fromEntries(formData);
      
      // Kiểm tra mật khẩu mới
      if (data.newPassword !== data.confirmPassword) {
        alert('Mật khẩu xác nhận không khớp!');
        return;
      }
      
      if (data.newPassword.length < 6) {
        alert('Mật khẩu phải có ít nhất 6 ký tự!');
        return;
      }
      
      fetch('/user/change-password', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Đổi mật khẩu thành công!');
          window.location.href = '/user/info';
        } else {
          alert(data.message || 'Có lỗi xảy ra');
        }
      })
      .catch(error => {
        console.error('Error:', error);
        alert('Có lỗi xảy ra khi đổi mật khẩu');
      });
    }); 
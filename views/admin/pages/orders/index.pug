extends ../../layouts/default.pug
include ../../mixins/filter-status-orders.pug
include ../../mixins/search.pug
include ../../mixins/pagination.pug
include ../../mixins/form-change-multi-orders.pug
include ../../mixins/alert.pug
include ../../mixins/sort.pug
include ../../mixins/moment.pug

block main
  +alert-success(5000)
  +alert-error(5000)

  h1 Danh sách đơn hàng

  .card.mb-3
    .card-header Bộ lọc và Tìm kiếm
    .card-body
      .row
        .col-6 
          +filter-status-orders(status)
        .col-6
          +search(keyword)
            
  .card.mb-3 
    .card-header Sắp xếp 
    .card-body 
      .row 
        .col-4 
          +sort()

  .card.mb-3
    .card-header Danh sách đơn hàng
    .card-body
      .row 
        .col-8
          +form-change-multi-orders(`${prefixAdmin}/orders/change-multi?_method=PATCH`)

      table(
        class="table table-hover table-sm"
        checkbox-multi
      )
        thead 
          tr 
            th 
              input(type="checkbox" name="checkall")
            th STT 
            th Mã đơn hàng
            th Khách hàng
            th Số điện thoại
            th Tổng tiền
            th Trạng thái
            th Ngày tạo
            th Hành động

        tbody 
        each item, index in orders
          tr 
            td 
              input(
                type="checkbox"
                name="id"
                value= item._id
              )
            td #{pagination.limitItems*(pagination.currentPage - 1) + (index + 1)}
            td #{item._id}
            td #{item.userInfo.fullName}
            td #{item.userInfo.phone}
            td #{item.totalPrice ? item.totalPrice.toLocaleString('vi-VN') + 'đ' : '0đ'}
            td 
              if(item.status == "pending")
                span.badge.badge-warning Chờ xử lý
              else if(item.status == "processing")
                span.badge.badge-info Đang xử lý
              else if(item.status == "shipped")
                span.badge.badge-primary Đang giao
              else if(item.status == "delivered")
                span.badge.badge-success Đã giao
              else if(item.status == "cancelled")
                span.badge.badge-danger Đã hủy
              else
                span.badge.badge-secondary #{item.status}
            td 
              +formatDateTime(item.createdAt)
            td 
              a(
                href=`${prefixAdmin}/orders/detail/${item._id}`
                class="btn btn-secondary btn-sm"
              ) Chi tiết
              button(
                class="btn btn-danger btn-sm ml-1"
                button-delete
                data-id= item._id
              ) Xóa

  +pagination(pagination)
  
  form(
    action=""
    method="POST"
    id="form-change-status"
    data-path= `${prefixAdmin}/orders/change-status`
  )

  form(
    action=""
    method="POST"
    id="form-delete-item"
    data-path= `${prefixAdmin}/orders/delete`
  )

  script(src="/admin/js/order.js") 